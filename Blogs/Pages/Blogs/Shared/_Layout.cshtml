@using Blogs.Model
@using Humanizer
@using Jx.Cms.Common.Utils
@using Jx.Cms.DbContext.Service.Both
@using Jx.Cms.Entities.Front
@using Jx.Cms.Themes.Vm
@using Masuit.Tools
@using Masuit.Tools.Html
@inject ISettingsService SettingsService
@inject IMenuService MenuService
@{
	var type = ViewBag.type as string;

	var settings = ViewBag.settings as Dictionary<string, string>;

	var blogs = ViewBag.blogs as Dictionary<string, string>;

	var menus = MenuService.GetAllMenuTree();

	async Task CreateMenu(MenuEntity menuEntity)
	{
		<li class="navbar-item"><a menu="@menuEntity" title="@menuEntity.Title" class="@(menuEntity.HasChildren ? "sf-with-ul" : "")">
		@Html.Raw(menuEntity.NavTitle)</a>
		@if (menuEntity.HasChildren)
		{
		<ul>
		 @foreach (var menu in menuEntity.Children)
			{
				await CreateMenu(menu);
			}
		</ul>
		}
		</li>
	}
}

<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
<meta name="renderer" content="webkit">
<meta name="applicable-device" content="pc,mobile">
<meta name="HandheldFriendly" content="true"/>
<meta name="robots" content="index,follow"/>
@await RenderSectionAsync("header", false)
@if (type == "Home")
{
	var index = Model as IndexVm;
	<title>@settings[SettingsConstants.TitleKey]@if (index.PageNum > 1)
	                                         {
		                                         @("-第" + index.PageNum + "页")
	                                         }-@settings[SettingsConstants.SubTitleKey]</title>
	<meta name="Keywords" content="@blogs[nameof(SettingsModel.Keywords)],@settings[SettingsConstants.TitleKey]">
	<meta name="description" content="@blogs[nameof(SettingsModel.Description)]">
}
else if (type == "Category")
{
	<title>{if $category.Metas.Blogs_fltitle}{$category.Metas.Blogs_fltitle}{else}{$category.Name}{/if}{if $page>'1'}{$zbp->Config('Blogs')->lianjiefu}第{$pagebar.PageNow}页{/if}{$zbp->Config('Blogs')->lianjiefu}{$name}</title>
	<meta name="Keywords" content="{if $category.Metas.Blogs_flgjc}{$category.Metas.Blogs_flgjc}{else}{$category.Name}{/if},{$name}">
	<meta name="description" content="{$category.Intro}">
}
else if (type == "Post")
{
	var article = Model as PostVm;
	<title>@($"{article!.Article.Title}{blogs[nameof(SettingsModel.Connector)]}{article.Article.Catalogue.Name}{blogs[nameof(SettingsModel.Connector)]}{settings[SettingsConstants.TitleKey]}")</title>
	var tag = article.Article.Labels;
	var keywords = tag.IsNullOrEmpty() ? article.Article.Title : string.Join(",", tag.Select(x => x.Name));
	var description = article.Article.Description.IsNullOrEmpty() ? article.Article.Content.RemoveHtmlTag().Truncate(135) : article.Article.Description.RemoveHtmlTag().Truncate(135);
	<meta name="keywords" content="@keywords"/>
	<meta name="description" content="@description"/>
	<meta name="author" content="@article.Article.Author">
}else if (type == "Page"){
	<title>{if $article.Metas.Blogs_pstitle}{$article.Metas.Blogs_pstitle}{else}{$title}{/if}{$zbp->Config('Blogs')->lianjiefu}{$name}</title>
	<meta name="keywords" content="{if $article.Metas.Blogs_psguanjianci}{$article.Metas.Blogs_psguanjianci}{else}{$title},{$name}{/if}"/>
// {php}
// 	if (strlen($article->Metas->Blogs_psmiaoshu)>0){
// 	$description = $article->Metas->Blogs_psmiaoshu;
// 	}else{
//     $description = preg_replace('/[\r\n\s]+/', ' ', trim(SubStrUTF8(TransferHTML($article->Content,'[nohtml]'),135)).'...');
// 	}
// {/php}
	<meta name="description" content="{$description}"/>
	<meta name="author" content="{$article.Author.StaticName}">
}else if(type == "Label") {
	<title>{if $tag->Metas->Blogs_bqtitle}{$tag.Metas.Blogs_bqtitle}{else}{$tag.Name}{/if}{if $page>'1'}{$zbp->Config('Blogs')->lianjiefu}第{$pagebar.PageNow}页{/if}{$zbp->Config('Blogs')->lianjiefu}{$name}</title>
	<meta name="Keywords" content="{if $tag->Metas->Blogs_bqgjc}{$tag.Metas.Blogs_bqgjc}{else}{$tag.Name}{/if},{$name}">
	<meta name="description" content="{$tag.Intro}">
}
else 
{
<title>{$title}{$zbp->Config('Blogs')->lianjiefu}{$name}{if $page>'1'}{$zbp->Config('Blogs')->lianjiefu}第{$pagebar.PageNow}页{/if}</title>
<meta name="Keywords" content="{$title},{$name}">
<meta name="description" content="{$title}{$zbp->Config('Blogs')->lianjiefu}{$name}{if $page>'1'}{$zbp->Config('Blogs')->lianjiefu}第{$pagebar.PageNow}页{/if}"> 
}
<link rel="shortcut icon" href="{$host}zb_users/theme/Blogs/Image/{php}Blogs_Get_Logo('favicon','ico');{/php}">
<link rel="profile" href="http://gmpg.org/xfn/11">
<!--[if lt IE 9]><script src="/Blogs/js/html5-css3.js"></script><![endif]-->
<link rel="stylesheet" rev="stylesheet" href="/Blogs/css/style.css" type="text/css" media="all"/>
<script src="/User/jquery-3.6.0.min.js" type="text/javascript"></script>
<script src="/Blogs/js/custom.js" type="text/javascript"></script>
<script src="/Blogs/js/slides.js" type="text/javascript"></script>
<script src="/Blogs/js/stickySidebar.js" type="text/javascript"></script>
<script src="/Blogs/js/script.js" type="text/javascript"></script>
<script src="/Blogs/js/scrollmonitor.js" type="text/javascript"></script>
@if(type is "Article" or "Page"){
<script src="/Blogs/js/fancybox.min.js" type="text/javascript"></script>
}
@* {if $zbp->Config('Blogs')->cblbiaoqian=='3' && $zbp->Config('Blogs')->cebianlanbj !== '3'} *@
@* <script src="{$host}zb_users/theme/{$theme}/script/3dtag.js" type="text/javascript"></script> *@
@* {/if} *@
<!--[if IE]>
<div class="tixing"><strong>温馨提示：感谢您访问本站，经检测您使用的浏览器为IE浏览器，为了获得更好的浏览体验，请使用Chrome、Firefox或其他浏览器。</strong>
</div>
<![endif]-->
<link rel="stylesheet" id="font-awesome-four-css" href="/Blogs/fonts/fontawesome-all.css" type='text/css' media='all'/>
@Html.Raw(blogs[nameof(SettingsModel.HeaderExtendCode)])
</head>
<body class="@type.ToLower()">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header">
		<nav id="top-header">
			<div class="top-nav">
				<div id="user-profile">
				@blogs[nameof(SettingsModel.WelcomeMessage)]
				</div>	
				<div class="menu-youshangjiao-container">
					<ul id="menu-youshangjiao" class="top-menu">@Html.Raw(blogs[nameof(SettingsModel.RightMenu)])</ul>
				</div>		
			</div>
		</nav><!-- #top-header -->
		<div id="menu-box">
			<div id="top-menu">
				<div class="logo-site">
					@if (type == "Home")
					{
						@:<h1 class="site-title">
					}
					else
					{
						@:<div>
					}
						<a href="/" title="@settings[SettingsConstants.TitleKey]-@settings[SettingsConstants.SubTitleKey]">
							<img src="/Blogs/Image/logo1.png" width="220" height="50" alt="@settings[SettingsConstants.TitleKey]-@settings[SettingsConstants.SubTitleKey]" title="@settings[SettingsConstants.TitleKey]-@settings[SettingsConstants.SubTitleKey]"/>
							<span>@settings[SettingsConstants.TitleKey]</span>
						</a>
						@if (type == "Home")
						{
						  @:</h1>
						}
						else
						{
							@:</div>
						}
				</div><!-- .logo-site -->			
				<span class="nav-search"><i class="fas fa-search"></i></span>
				<div id="site-nav-wrap">
					<div id="sidr-close"><a href="#sidr-close" class="toggle-sidr-close">X</a></div>
					<nav id="site-nav" class="main-nav"> 
						<a href="#sidr-main" id="navigation-toggle" class="bars"><i class="fa fa-bars"></i></a> 
						<div id="divNavBar-main">
							<ul id="menu-main" class="down-menu nav-menu sf-js-enabled sf-arrows">
								@foreach (var menu in menus)
								{
									await CreateMenu(menu);
								}
							</ul>
						</div> 
					</nav>
				</div><!-- #site-nav-wrap -->
			</div><!-- #top-menu -->
		</div><!-- #menu-box -->
	</header><!-- #masthead -->
<div id="main-search">
	<div id="searchbar">
	<form id="searchform" name="search" method="post" action="{$host}zb_system/cmd.php?act=search">
	<input type="text" name="q" placeholder="输入搜索内容"> 
	<button type="submit" id="searchsubmit">搜索</button>
	</form>
	</div>	
	<div class="clear"></div>
</div>
@if(type == "Home"){
	<nav class="breadcrumb" @if (blogs[nameof(SettingsModel.Notice)] == "")
                        {
	                        @("style = 'height:15px;'")
                        }>
@if (blogs[nameof(SettingsModel.Notice)] != ""){
<div id="scrolldiv">
	<div class="bull"></div>
		<div class="scrolltext">
			<ul style="margin-top: 0px;">@Html.Raw(blogs[nameof(SettingsModel.Notice)])</ul>
		</div>
</div> 
<script type="text/javascript">$(document).ready(function() {$("#scrolldiv").textSlider({line: 1, speed: 1000, timer: 3000});})</script>
}
</nav>
}
else
{
	<nav class="breadcrumb"><a title="返回首页" href="/">首页</a>
		@if (type == "Catalogue")
		{
			@:&nbsp;&gt;&nbsp;
			<a href="{$category.Url}" target="_blank">{$category.Name}</a>
			@:&nbsp;&gt;&nbsp;文章
		}
		{if $type=='article'}&nbsp;&gt;&nbsp;<a href="{$article.Category.Url}" target="_blank">{$article.Category.Name}</a>&nbsp;&gt;&nbsp;正文{/if}
		{if $type=='page'}&nbsp;&gt;&nbsp;{$title}{/if}
		{if $type=='author'}&nbsp;&gt;&nbsp;{$title}发表的文章{/if}
		{if $type=='date'}&nbsp;&gt;&nbsp;发表于{$title}的文章{/if}
		{if $type=='tag'}&nbsp;&gt;&nbsp;{$title}标签文章{/if}</nav>
}

</div>
@RenderBody()
<div id="footer">
<div class="foot">
@if (type == "Home")
{
	<div id="links">
		<ul class="linkcat"> <li><strong>友情链接：</strong></li>
			{module:link}
		</ul>
		<div class="clear"></div></div>
}
	<div class="ps">
<div class="p p2">
	<div class="clear"></div>
<div class="site-info">Copyright ©  @settings[SettingsConstants.TitleKey] @if (settings.ContainsKey(SettingsConstants.BeiAnKey) && !settings[SettingsConstants.BeiAnKey].IsNullOrEmpty())
                       {
	                       @("|")
	                       <a href="http://beian.miit.gov.cn" target="_blank" rel="nofollow">@settings[SettingsConstants.BeiAnKey]</a>
                       }<span class="footer-tag">&nbsp; | &nbsp; Theme by <a href="http://yigujin.wang/"  target="_blank" title="免费响应式博客主题BlogsV2.0">Blogs</a>&nbsp; | &nbsp; Powered by <a href="http://www.jvxiang.com/" title="JX.CMS" target="_blank">JX.CMS</a></span></div>
</div>
	</div>
</div>
</div>
</div>

<div class="tools">
    <a class="tools_top" title="返回顶部"></a>
    @if (type == "Article" || type == "Page")
    {
	    
    
	<a class="tools_comments" title="发表评论"></a>
    }
    else
    {
	    <a href="{$zbp->Config('Blogs')->liuyanban}#divCommentPost" class="tools_comments" title="给我留言" target="_blank" rel="nofollow"></a>
    }
    </div>
@if (type == "Article" || type == "Page"){
<script type="text/javascript">
const regx = /\.(jpe?g|png|bmp|gif|swf)(?=\?|$)/i;
$('.single-content').find('a').each(function(){
    const href = $(this).attr('href');
    const isImg = regx.test(href);
    if (isImg) {
        $(this).attr({'data-fancybox':'images','class':'cboxElement','rel':'example_group'});
    }
});
</script>
}
<script src="/Blogs/js/superfish.js" type="text/javascript"></script>
@blogs[nameof(SettingsModel.FooterExtendCode)]
</div>
</body>
</html>